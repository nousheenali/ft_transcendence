{"version":3,"sources":["../../../src/server/stream-utils/node-web-streams-helper.ts"],"names":["streamToBufferedResult","cloneTransformStream","readableStreamTee","chainStreams","streamFromArray","streamToString","createBufferedTransformStream","createInsertedHTMLStream","renderToInitialStream","createDeferredSuffixStream","createInlineDataStream","createSuffixStream","createRootLayoutValidatorStream","continueFromInitialStream","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","renderResult","renderChunks","textDecoder","TextDecoder","writable","write","chunk","push","decodeText","end","destroy","pipe","join","source","sourceReader","readable","getReader","clone","TransformStream","start","controller","done","value","read","enqueue","transform","transformStream","transformStream2","writer","getWriter","writer2","reader","then","close","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","strings","forEach","str","encodeText","stream","bufferedString","v","pendingFlush","flushBuffer","buffered","flush","getServerInsertedHTML","insertedHTMLChunk","ReactDOMServer","element","streamOptions","getTracer","trace","AppRenderSpan","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","suffix","suffixFlushed","suffixFlushTask","res","dataStream","dataStreamFinished","dataStreamReader","err","error","foundSuffix","endsWith","contentWithoutSuffix","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","nonNullable","JSON","stringify","tree","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}